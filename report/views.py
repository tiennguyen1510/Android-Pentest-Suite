# -*- coding: utf-8 -*-
from __future__ import unicode_literals
from django.shortcuts import render
from django.http import JsonResponse
from report.models import *
from utils import report_handle
import utils.common as common

def report(request, app_name):
    return render(request, 'report.html', {
        'app_name': app_name
    })


def report_data(request, app_name):
    data = {
        'high': [
            ReportQark.objects.filter(severity='VULNERABILITY').filter(app_name=app_name).count(),
            ReportDc.objects.filter(severity='HIGH').filter(app_name=app_name).count(), 
            ReportAndro.objects.filter(severity='Critical').filter(app_name=app_name).count()
        ], 
        'medium': [
            ReportQark.objects.filter(severity='WARNING').filter(app_name=app_name).count(),
            ReportDc.objects.filter(severity='MEDIUM').filter(app_name=app_name).count(),
            ReportAndro.objects.filter(severity='Warning').filter(app_name=app_name).count()
        ], 
        'low': [
            ReportQark.objects.filter(severity='INFO').filter(app_name=app_name).count(),
            ReportDc.objects.filter(severity='LOW').filter(app_name=app_name).count(),
            ReportAndro.objects.filter(severity='Info').filter(app_name=app_name).count()
        ],
        'sensitive' : [
            ReportSniffgit.objects.filter(location='Source Code').filter(app_name=app_name).count(), 
            ReportSniffgit.objects.filter(location="User's data").filter(app_name=app_name).count()
        ]      
    }
    return JsonResponse(data)

def view_all(request):
    return render(request, 'report_all.html', {
        'app_list': common.get_app_list()
    })